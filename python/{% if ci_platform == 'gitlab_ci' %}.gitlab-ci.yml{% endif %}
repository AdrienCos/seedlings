variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"

before_script:
  # HACK: when using gitlab-ci-local, the UID of the .cache directory owner is
  # not consistent between stages, and causes Pip to ignore the cache
  # see: https://github.com/firecow/gitlab-ci-local/issues/705
  - mkdir -p .cache/pip
  - chown -R $(id -u) .cache
  - pip install pdm

stages:
  - setup
  - lint
  - test
  - build

cache:
  key: pip-cache
  paths:
    - .cache/pip

include:
  - local: ".gitlab-ci/lint.yml"
  - local: ".gitlab-ci/package.yml"
  - local: ".gitlab-ci/pex.yml"
  - local: ".gitlab-ci/setup.yml"
  - local: ".gitlab-ci/test.yml"
